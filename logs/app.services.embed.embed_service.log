2025-11-14 03:31:34,557 - app.services.embed.embed_service - INFO - Starting embed pipeline for user: testing1, URL: https://2alabs.blob.core.windows.net/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf
2025-11-14 03:31:34,558 - app.services.embed.embed_service - INFO - Step 1: Downloading document from Azure...
2025-11-14 03:31:34,767 - app.services.embed.embed_service - ERROR - Error in embed pipeline: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:3c94745b-101e-000d-59e9-543609000000
Time:2025-11-13T22:01:34.8649017Z
ErrorCode:AuthenticationFailed
authenticationerrordetail:The MAC signature found in the HTTP request 'uxAYTt553uc8tWM9yufAt6OfZJwWgDw6E0b+9owDfn0=' is not the same as any computed signature. Server used following string to sign: 'GET











x-ms-client-request-id:51c39a5c-c0dc-11f0-90ca-1aff750a1cb9
x-ms-date:Thu, 13 Nov 2025 22:01:34 GMT
x-ms-range:bytes=0-33554431
x-ms-version:2023-11-03
/2alabs/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf'.
Content: <?xml version="1.0" encoding="utf-8"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:3c94745b-101e-000d-59e9-543609000000
Time:2025-11-13T22:01:34.8649017Z</Message><AuthenticationErrorDetail>The MAC signature found in the HTTP request 'uxAYTt553uc8tWM9yufAt6OfZJwWgDw6E0b+9owDfn0=' is not the same as any computed signature. Server used following string to sign: 'GET











x-ms-client-request-id:51c39a5c-c0dc-11f0-90ca-1aff750a1cb9
x-ms-date:Thu, 13 Nov 2025 22:01:34 GMT
x-ms-range:bytes=0-33554431
x-ms-version:2023-11-03
/2alabs/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf'.</AuthenticationErrorDetail></Error>
Traceback (most recent call last):
  File "/Users/alkushpipania/Desktop/stealth/app/services/embed/embed_service.py", line 41, in process_embed
    local_file_path = await self.azure_downloader.download_from_url(azure_url)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/app/utils/azure_downloader.py", line 69, in download_from_url
    download_stream = blob_client.download_blob()
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/core/tracing/decorator.py", line 119, in wrapper_use_tracer
    return func(*args, **kwargs)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_blob_client.py", line 942, in download_blob
    return StorageStreamDownloader(**options)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_download.py", line 366, in __init__
    self._response = self._initial_request()
                     ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_download.py", line 462, in _initial_request
    process_storage_error(error)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_shared/response_handlers.py", line 184, in process_storage_error
    exec("raise error from None")   # pylint: disable=exec-used # nosec
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe_handle=7)
    ^^^^^^^^^^^^^^^^^^^^^
azure.core.exceptions.ClientAuthenticationError: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:3c94745b-101e-000d-59e9-543609000000
Time:2025-11-13T22:01:34.8649017Z
ErrorCode:AuthenticationFailed
authenticationerrordetail:The MAC signature found in the HTTP request 'uxAYTt553uc8tWM9yufAt6OfZJwWgDw6E0b+9owDfn0=' is not the same as any computed signature. Server used following string to sign: 'GET











x-ms-client-request-id:51c39a5c-c0dc-11f0-90ca-1aff750a1cb9
x-ms-date:Thu, 13 Nov 2025 22:01:34 GMT
x-ms-range:bytes=0-33554431
x-ms-version:2023-11-03
/2alabs/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf'.
Content: <?xml version="1.0" encoding="utf-8"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:3c94745b-101e-000d-59e9-543609000000
Time:2025-11-13T22:01:34.8649017Z</Message><AuthenticationErrorDetail>The MAC signature found in the HTTP request 'uxAYTt553uc8tWM9yufAt6OfZJwWgDw6E0b+9owDfn0=' is not the same as any computed signature. Server used following string to sign: 'GET











x-ms-client-request-id:51c39a5c-c0dc-11f0-90ca-1aff750a1cb9
x-ms-date:Thu, 13 Nov 2025 22:01:34 GMT
x-ms-range:bytes=0-33554431
x-ms-version:2023-11-03
/2alabs/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf'.</AuthenticationErrorDetail></Error>
2025-11-14 03:38:28,718 - app.services.embed.embed_service - INFO - Starting embed pipeline for user: testing1, URL: https://2alabs.blob.core.windows.net/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf
2025-11-14 03:38:28,719 - app.services.embed.embed_service - INFO - Step 1: Downloading document from Azure...
2025-11-14 03:38:29,012 - app.services.embed.embed_service - ERROR - Error in embed pipeline: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:dcf1f50a-201e-004b-2eea-54028e000000
Time:2025-11-13T22:08:29.0898555Z
ErrorCode:AuthenticationFailed
authenticationerrordetail:sr is mandatory. Cannot be empty
Content: <?xml version="1.0" encoding="utf-8"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:dcf1f50a-201e-004b-2eea-54028e000000
Time:2025-11-13T22:08:29.0898555Z</Message><AuthenticationErrorDetail>sr is mandatory. Cannot be empty</AuthenticationErrorDetail></Error>
Traceback (most recent call last):
  File "/Users/alkushpipania/Desktop/stealth/app/services/embed/embed_service.py", line 41, in process_embed
    local_file_path = await self.azure_downloader.download_from_url(azure_url)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/app/utils/azure_downloader.py", line 74, in download_from_url
    download_stream = blob_client.download_blob()
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/core/tracing/decorator.py", line 119, in wrapper_use_tracer
    return func(*args, **kwargs)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_blob_client.py", line 942, in download_blob
    return StorageStreamDownloader(**options)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_download.py", line 366, in __init__
    self._response = self._initial_request()
                     ~~~~~~~~~~~~~~~~~~~~~^^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_download.py", line 462, in _initial_request
    process_storage_error(error)
    ~~~~~~~~~~~~~~~~~~~~~^^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/azure/storage/blob/_shared/response_handlers.py", line 184, in process_storage_error
    exec("raise error from None")   # pylint: disable=exec-used # nosec
    ~~~~^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 1, in <module>
    from multiprocessing.spawn import spawn_main; spawn_main(tracker_fd=5, pipe_handle=7)
    ^^^^^^^^^^^^^^^^^^^^^
azure.core.exceptions.ClientAuthenticationError: Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:dcf1f50a-201e-004b-2eea-54028e000000
Time:2025-11-13T22:08:29.0898555Z
ErrorCode:AuthenticationFailed
authenticationerrordetail:sr is mandatory. Cannot be empty
Content: <?xml version="1.0" encoding="utf-8"?><Error><Code>AuthenticationFailed</Code><Message>Server failed to authenticate the request. Make sure the value of Authorization header is formed correctly including the signature.
RequestId:dcf1f50a-201e-004b-2eea-54028e000000
Time:2025-11-13T22:08:29.0898555Z</Message><AuthenticationErrorDetail>sr is mandatory. Cannot be empty</AuthenticationErrorDetail></Error>
2025-11-14 03:44:04,034 - app.services.embed.embed_service - INFO - Starting embed pipeline for user: testing1, URL: https://2alabs.blob.core.windows.net/document/1755637453100-Rich-Dad-Poor-Dad-eBook.pdf
2025-11-14 03:44:04,035 - app.services.embed.embed_service - INFO - Step 1: Downloading document from Azure...
2025-11-14 03:44:04,899 - app.services.embed.embed_service - INFO - Document downloaded to: /var/folders/rj/5n7725ps40z8wn8p1kcy6ldw0000gn/T/tmpf4s3g5q6.pdf
2025-11-14 03:44:04,899 - app.services.embed.embed_service - INFO - Step 2: Parsing document with multimodal parser...
2025-11-14 03:45:38,418 - app.services.embed.embed_service - INFO - Parsed 605 chunks from document
2025-11-14 03:45:38,418 - app.services.embed.embed_service - INFO - Step 3: Extracting entities and relationships...
2025-11-14 03:46:19,203 - app.services.embed.embed_service - INFO - Extracted 149 entities and 160 relationships
2025-11-14 03:46:19,203 - app.services.embed.embed_service - INFO - Step 4: Generating embeddings for chunks...
2025-11-14 03:46:19,449 - app.services.embed.embed_service - ERROR - Error in embed pipeline: Error embedding content: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0 [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerProjectPerModel-FreeTier"
}
]
Traceback (most recent call last):
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/langchain_google_genai/embeddings.py", line 227, in embed_documents
    result = self.client.batch_embed_contents(
        BatchEmbedContentsRequest(requests=requests, model=self.model)
    )
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/ai/generativelanguage_v1beta/services/generative_service/client.py", line 1379, in batch_embed_contents
    response = rpc(
        request,
    ...<2 lines>...
        metadata=metadata,
    )
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/gapic_v1/method.py", line 131, in __call__
    return wrapped_func(*args, **kwargs)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/retry/retry_unary.py", line 294, in retry_wrapped_func
    return retry_target(
        target,
    ...<3 lines>...
        on_error=on_error,
    )
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/retry/retry_unary.py", line 156, in retry_target
    next_sleep = _retry_error_helper(
        exc,
    ...<6 lines>...
        timeout,
    )
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/retry/retry_base.py", line 214, in _retry_error_helper
    raise final_exc from source_exc
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/retry/retry_unary.py", line 147, in retry_target
    result = target()
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/timeout.py", line 130, in func_with_timeout
    return func(*args, **kwargs)
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/google/api_core/grpc_helpers.py", line 77, in error_remapped_callable
    raise exceptions.from_grpc_error(exc) from exc
google.api_core.exceptions.ResourceExhausted: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0 [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerProjectPerModel-FreeTier"
}
]

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/Users/alkushpipania/Desktop/stealth/app/services/embed/embed_service.py", line 71, in process_embed
    chunk.embedding = self.pinecone_manager.get_embedding(chunk.content)
                      ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/app/services/embed/pinecone_manager.py", line 43, in get_embedding
    return self.embeddings.embed_query(text)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/langchain_google_genai/embeddings.py", line 256, in embed_query
    return self.embed_documents(
           ~~~~~~~~~~~~~~~~~~~~^
        [text],
        ^^^^^^^
    ...<2 lines>...
        output_dimensionality=output_dimensionality,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )[0]
    ^
  File "/Users/alkushpipania/Desktop/stealth/venv/lib/python3.14/site-packages/langchain_google_genai/embeddings.py", line 231, in embed_documents
    raise GoogleGenerativeAIError(f"Error embedding content: {e}") from e
langchain_google_genai._common.GoogleGenerativeAIError: Error embedding content: 429 You exceeded your current quota, please check your plan and billing details. For more information on this error, head to: https://ai.google.dev/gemini-api/docs/rate-limits. To monitor your current usage, head to: https://ai.dev/usage?tab=rate-limit. 
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0
* Quota exceeded for metric: generativelanguage.googleapis.com/embed_content_free_tier_requests, limit: 0 [links {
  description: "Learn more about Gemini API quotas"
  url: "https://ai.google.dev/gemini-api/docs/rate-limits"
}
, violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerMinutePerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerUserPerProjectPerModel-FreeTier"
}
violations {
  quota_metric: "generativelanguage.googleapis.com/embed_content_free_tier_requests"
  quota_id: "EmbedContentRequestsPerDayPerProjectPerModel-FreeTier"
}
]
2025-11-14 03:46:19,460 - app.services.embed.embed_service - INFO - Cleaned up temporary file: /var/folders/rj/5n7725ps40z8wn8p1kcy6ldw0000gn/T/tmpf4s3g5q6.pdf
